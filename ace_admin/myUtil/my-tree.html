<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta charset="utf-8" />
    <title>Dashboard - Ace Admin</title>

    <meta name="description" content="overview &amp; stats" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

    <!-- bootstrap & fontawesome -->
    <link rel="stylesheet" href="../assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="../assets/font-awesome/4.5.0/css/font-awesome.min.css" />

    <!-- page specific plugin styles -->

    <!-- text fonts -->
    <link rel="stylesheet" href="../assets/css/fonts.googleapis.com.css" />

    <!-- ace styles -->
    <link rel="stylesheet" href="../assets/css/ace.min.css" class="ace-main-stylesheet" id="main-ace-style" />

    <!--[if lte IE 9]>
			<link rel="stylesheet" href="assets/css/ace-part2.min.css" class="ace-main-stylesheet" />
		<![endif]-->
    <link rel="stylesheet" href="../assets/css/ace-skins.min.css" />
    <link rel="stylesheet" href="../assets/css/ace-rtl.min.css" />


    <!--[if lte IE 9]>
		  <link rel="stylesheet" href="assets/css/ace-ie.min.css" />
		<![endif]-->

    <!-- inline styles related to this page -->

    <!-- ace settings handler -->
    <script src="../assets/js/ace-extra.min.js"></script>

    <!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->

    <!--[if lte IE 8]>
		<script src="assets/js/html5shiv.min.js"></script>
		<script src="assets/js/respond.min.js"></script>
		<![endif]-->
</head>

<body class="no-skin">
    <div class="main-container ace-save-state" id="main-container">
        <div class="main-content">
            <div class="main-content-inner">
                <div class="page-content">
                    <button type="button" class="btn btn-default" id="add_btn">新增</button>
                    <button type="button" class="btn btn-default" id="remove_btn">删除</button>
                    <button type="button" class="btn btn-default" id="updata_btn">编辑</button>
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="widget-box widget-color-green2">
                                        <div class="widget-body">
                                            <div class="widget-main padding-8">
                                                <ul id="tree"></ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="widget-box widget-color-green2">
                                        <div class="widget-body">
                                            <div class="widget-main padding-8">
                                                <ul id="tree2"></ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.page-content -->
            </div>
        </div>
        <!-- /.main-content -->
    </div>
    <!-- /.main-container -->
</body>
<!-- basic scripts -->

<!--[if !IE]> -->
<script src="../assets/js/jquery-2.1.4.min.js"></script>

<!-- <![endif]-->

<!--[if IE]>
<script src="assets/js/jquery-1.11.3.min.js"></script>
<![endif]-->
<script type="text/javascript">
    if ('ontouchstart' in document.documentElement) document.write(
        "<script src='assets/js/jquery.mobile.custom.min.js'>" +
        "<" + "/script>");
</script>
<script src="../assets/js/bootstrap.min.js"></script>

<!-- page specific plugin scripts -->

<!--[if lte IE 8]>
		  <script src="assets/js/excanvas.min.js"></script>
		<![endif]-->
<script src="../assets/js/jquery-ui.custom.min.js"></script>
<script src="../assets/js/jquery.ui.touch-punch.min.js"></script>
<script src="../assets/js/jquery.easypiechart.min.js"></script>
<script src="../assets/js/jquery.sparkline.index.min.js"></script>
<script src="../assets/js/jquery.flot.min.js"></script>
<script src="../assets/js/jquery.flot.pie.min.js"></script>
<script src="../assets/js/jquery.flot.resize.min.js"></script>

<!-- ace scripts -->
<script src="../assets/js/ace-elements.min.js"></script>
<script src="../assets/js/ace.min.js"></script>

<!-- page specific plugin scripts -->
<script src="../assets/js/tree.min.js"></script>

<!-- 自定义js -->
<script type="text/javascript">

    var data = [{
            name: "所有人",
            type: "folder",
            id: 0,
            children: [{
                    name: "老板",
                    type: "item",
                    id: 1,
                    data: {
                        a: '123'
                    },
                },
                {
                    name: "操作员",
                    type: "folder",
                    id: 2,
                    children: [{
                            name: "操作员1",
                            type: "item",
                            id: 3,
                        },
                        {
                            name: "操作员2",
                            type: "item",
                            id: 4,
                        },
                        {
                            name: "操作员3",
                            type: "item",
                            id: 5,
                        },
                        {
                            name: "操作员4",
                            type: "item",
                            id: 6,
                        },
                    ]
                },
                {
                    name: "店长",
                    type: "item",
                    id: 7,
                    data: {
                        a: '123'
                    }
                },
                {
                    name: "副店长",
                    type: "item",
                    id: 8,
                    data: {
                        a: '123'
                    }
                },
                {
                    name: "采购员",
                    type: "folder",
                    id: 9,
                    children: [{
                            name: "采购员1",
                            type: "item",
                            id: 10,
                        },
                        {
                            name: "采购员2",
                            type: "item",
                            id: 11,
                        },
                        {
                            name: "采购员3",
                            type: "item",
                            id: 12,
                        },
                        {
                            name: "采购员4",
                            type: "item",
                            id: 13,
                        },
                    ]
                },
            ],

        },

    ]

    var data2 = [{
            name: "所有人",
            type: "folder",
            id: 0,
            children: [{
                    name: "老板",
                    type: "item",
                    id: 1,
                    data: {
                        a: '123'
                    },
                },
                {
                    name: "操作员",
                    type: "folder",
                    id: 2,
                    children: [{
                            name: "操作员1",
                            type: "item",
                            id: 3,
                        },
                        {
                            name: "操作员2",
                            type: "item",
                            id: 4,
                        },
                        {
                            name: "操作员3",
                            type: "item",
                            id: 5,
                        },
                        {
                            name: "操作员4",
                            type: "item",
                            id: 6,
                        },
                    ]
                },
                {
                    name: "店长",
                    type: "item",
                    id: 7,
                    data: {
                        a: '123'
                    }
                },
                {
                    name: "副店长",
                    type: "item",
                    id: 8,
                    data: {
                        a: '123'
                    }
                },
                {
                    name: "采购员",
                    type: "folder",
                    id: 9,
                    children: [{
                            name: "采购员1",
                            type: "item",
                            id: 10,
                        },
                        {
                            name: "采购员2",
                            type: "item",
                            id: 11,
                        },
                        {
                            name: "采购员3",
                            type: "item",
                            id: 12,
                        },
                        {
                            name: "采购员4",
                            type: "item",
                            id: 13,
                        },
                    ]
                },
            ],

        },

    ]
    var data3 = [{
            name: "操作员1",
            type: "item",
            id: 3,
        },
        {
            name: "操作员2",
            type: "item",
            id: 4,
        },
        {
            name: "操作员3",
            type: "item",
            id: 5,
        },
        {
            name: "操作员4",
            type: "item",
            id: 6,
        },
    ]
    //封装插件
    //ele->根元素，ul标签,JQdom
    //data->原数据
    //multiSelect->是否多选  true/false
    //selectedId->当前选中项id集  []  multiSelect必须为true
    function tree_view({
        "ele": ele,
        "data": data,
        "multiSelect": multiSelect,
        "selectedId": selectedId
    }) {
        //初始数据   
        //type:"item"/"folder"  name:""  id:(唯一)
        var tree_data = data
        //当前选中项
        var treeItem;
        //底部数据处理
        var sampleData = initiateDemoData();
        //获取根元素
        var this_tree = ele;
        var myTree = this_tree.ace_tree({
            dataSource: sampleData['dataSource'],
            loadingHTML: '<div class="tree-loading"><i class="ace-icon fa fa-refresh fa-spin blue"></i></div>',
            'open-icon': 'ace-icon fa fa-folder-open',
            'close-icon': 'ace-icon fa fa-folder',
            'itemSelect': true,
            'folderSelect': true,
            'multiSelect': multiSelect ? multiSelect : false, //是否多选
            'cacheItems': true,
            'selected-icon': null,
            'unselected-icon': null,
            'folder-open-icon': 'ace-icon tree-plus',
            'folder-close-icon': 'ace-icon tree-minus',
        });
        //选中项初始化
        if (multiSelect) {
            if (selectedId && selectedId.length > 0) {
                function initSelected(datas, id) {
                    return $.map(datas, function (item, index) {
                        if (item.id === id) {
                            item['additionalParameters'] = {
                                'item-selected': true
                            }
                        } else {
                            if (item.children) {
                                item.children = initSelected(item.children, id)
                            }
                        }
                        return item;
                    })
                }
                selectedId.forEach(function (val, key) {
                    tree_data = initSelected(tree_data, val)
                })
                //console.log(tree_data);
            }
        };
        /**
        //Use something like this to reload data	
        $('#tree1').find("li:not([data-template])").remove();
        $('#tree1').tree('render');
        */


        /**
        //please refer to docs for more info
        $('#tree1')
        .on('loaded.fu.tree', function(e) {
        })
        .on('updated.fu.tree', function(e, result) {
        })
        .on('selected.fu.tree', function(e) {
        })
        .on('deselected.fu.tree', function(e) {
        })
        .on('opened.fu.tree', function(e) {
        })
        .on('closed.fu.tree', function(e) {
        });
        */
        //获取当前选中项
        //this_tree.tree('selectedItems');
        //console.log(this_tree.tree('selectedItems'));
        //取消所有选中
        //this_tree.tree('deselectAll')
        //console.log(this_tree.tree('deselectAll'));
        //销毁实例
        //console.log(this_tree.tree('destroy'));

        //默认展开第一项
        //this_tree.tree('discloseVisible');

        //默认展开所有项
        this_tree.tree('discloseAll');

        //更新视图
        function updated_treeview(data) {
            tree_data = data;
            this_tree.find("li:not([data-template])").remove();
            this_tree.tree('render');
            this_tree.tree('discloseAll');
        }
        //初始化数据处理
        function initiateDemoData() {
            var dataSource = function (options, callback) {
                var $data = null
                if (!("text" in options) && !("type" in options)) {
                    $data = tree_data; //the root tree
                    callback({
                        data: $data
                    });
                    return;
                } else if ("type" in options && options.type == "folder") {
                    if ("additionalParameters" in options && "children" in options.additionalParameters)
                        $data = options.additionalParameters.children || {};
                    else if ("children" in options)
                        $data = options.children || {};
                    else $data = {} //no data
                }

                if ($data != null) //this setTimeout is only for mimicking some random delay
                    /* setTimeout(function () {
                            callback({
                                data: $data
                            });
                        }, parseInt(Math.random() * 500) + 200); */
                    callback({
                        data: $data
                    });
            }
            return {
                'dataSource': dataSource
            }
        }
        return {
            "ele": ele,
            "updated_treeview": updated_treeview,
        }
    }


    //demo
    var this_item;
    var tree_demo = tree_view({
        ele: $('#tree'),
        data: data,
        //multiSelect: false,
    });

    var tree_demo2 = tree_view({
        ele: $('#tree2'),
        data: data2,
        multiSelect: true,
        selectedId: [1, 2, 3]
    });

    //输出当前选项
    //item.target 最后选中项
    //item.selected 选中项集合
    tree_demo.ele.on('selected.fu.tree', function (e, item) {
        console.log(item.target);

        this_item = item.target;
    });

    tree_demo2.ele.on('selected.fu.tree', function (e, item) {
        console.log(item);
    });


    //更新
    /* tree_demo.updated_treeview(data); */
    function update_tree() {
        $.ajax({
            type: "method",
            url: "url",
            data: "data",
            dataType: "dataType",
            success: function (res) {
                var data = res.data
                tree_demo.updated_treeview(data);
            }
        });
    }



    //增加
    $('#add_btn').on('click', function () {
        alert(JSON.stringify(this_item));
        /* $.ajax({
            type: "method",
            url: "url",
            data: {
                id: 0
            },
            dataType: "JSON",
            success: function (res) {
                if (res.status === 0) {
                    update_tree()
                }
            }
        }); */
    });

    //删除
    $('#remove_btn').on('click', function () {
        alert(JSON.stringify(this_item));
        $.ajax({
            type: "method",
            url: "url",
            data: {
                id: 0
            },
            dataType: "JSON",
            success: function (res) {
                if (res.status === 0) {
                    update_tree()
                }
            }
        });
    });

    //修改
    $('#updata_btn').on('click', function () {
        alert(JSON.stringify(this_item));
        $.ajax({
            type: "method",
            url: "url",
            data: {
                id: 0,
                name: "",
                type: "",
                data: ""
            },
            dataType: "JSON",
            success: function (res) {
                if (res.status === 0) {
                    update_tree()
                }
            }
        });
    });
</script>
</html>